# Exemple de profil de service
# Copier ce fichier et l'adapter pour chaque nouveau service
# Emplacement : profiles/<nom-service>.yml

# ============================================
# INFORMATIONS DU SERVICE
# ============================================
name: example-service
description: "Service exemple pour démonstration"
enabled: false  # false pour désactiver le service sans supprimer le profil
always_active: false  # Si true, démarré automatiquement sans --profile
docker_profile: example  # Nom du profil Docker (ou null si always_active)

# ============================================
# CONFIGURATION DOCKER
# ============================================
docker-compose:
  # Image Docker avec support des variables d'environnement
  # Permet de basculer facilement entre différentes versions/registres
  # Syntaxe : ${VARIABLE:-valeur_par_defaut}
  
  # Option 1 : Image complète avec tag (simple)
  # image: ${EXAMPLE_IMAGE:-nginx:latest}
  
  # Option 2 : Image et tag séparés (recommandé - plus flexible)
  image: ${EXAMPLE_IMAGE:-nginx}:${EXAMPLE_TAG:-latest}
  
  # Option 3 : Décomposition complète (maximum de flexibilité)
  # image: ${EXAMPLE_REGISTRY:-docker.io}/${EXAMPLE_IMAGE:-nginx}:${EXAMPLE_TAG:-latest}
  
  container_name: example-service
  ports:
    - "${EXAMPLE_PORT:-8090}:80"
  environment:
    # NOTE : Les variables partagées depuis config.yml sont automatiquement injectées
    # Elles apparaîtront en premier dans docker-compose.yml avec un commentaire
    # Ex: LOG_LEVEL, NODE_ENV, API_GATEWAY_URL, etc.
    #
    # Les variables ci-dessous sont spécifiques à ce service et seront ajoutées après
    - ENV_MODE=docker
    - SERVICE_NAME=example
    - EXAMPLE_API_KEY=${EXAMPLE_API_KEY:-default-key}
    # Variables référençant config.yml shared_env (exemple) :
    # Ces variables seront automatiquement disponibles sans les redéfinir :
    # - LOG_LEVEL (depuis shared_env.global)
    # - API_GATEWAY_URL (depuis shared_env.external_services)
  healthcheck:
    test: ["CMD", "curl", "-f", "http://localhost:80/"]
    interval: 30s
    timeout: 5s
    retries: 3
    start_period: 10s

# Exemples d'utilisation :
# 
# 1. Image par défaut (nginx:latest) :
#    just start-profile example
# 
# 2. Changer uniquement le tag :
#    $env:EXAMPLE_TAG="alpine"
#    just start-profile example
# 
# 3. Changer l'image et le tag :
#    $env:EXAMPLE_IMAGE="httpd"
#    $env:EXAMPLE_TAG="2.4"
#    just start-profile example
# 
# 4. Image privée avec registre :
#    $env:EXAMPLE_REGISTRY="myregistry.com"
#    $env:EXAMPLE_IMAGE="my-nginx"
#    $env:EXAMPLE_TAG="custom"
#    just start-profile example
# 
# 5. Image locale pour développement :
#    $env:EXAMPLE_IMAGE="my-custom-nginx"
#    $env:EXAMPLE_TAG="local"
#    just start-profile example
# 
# 6. Avec port personnalisé :
#    $env:EXAMPLE_PORT="9090"
#    $env:EXAMPLE_TAG="alpine"
#    just start-profile example

# ============================================
# CONFIGURATION TRAEFIK
# ============================================
traefik:
  # Activer l'intégration Traefik
  enabled: true
  
  # Préfixe de route (ex: /example -> http://localhost/example)
  prefix: /example
  
  # Supprimer le préfixe avant de transmettre au service
  strip_prefix: true
  
  # Port du service docker à exposer via Traefik
  docker_port: 80

  # Port du service local à exposer via Traefik
  local_port: 8090
  
  # Priorité de la route (optionnel, défaut: 10)
  priority: 10
  
  # Middlewares additionnels (optionnel)
  # middlewares:
  #   - auth
  #   - compress

# ============================================
# SECRETS (optionnel)
# ============================================
# Variables de secrets requises (à définir dans secrets.env)
secrets:
  - name: EXAMPLE_API_KEY
    description: "Clé API pour le service exemple"
    default: default-key

# ============================================
# MÉTADONNÉES (optionnel)
# ============================================
metadata:
  # Catégorie du service
  category: web
  
  # Tags pour filtrage
  tags:
    - example
    - demo
  
  # Documentation
  docs_url: https://nginx.org/en/docs/
  
  # Mainteneur
  maintainer: team@example.com
